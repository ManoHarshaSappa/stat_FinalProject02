<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Final Project - Research Design</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Final Project</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./Home.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Dataset Description.html"> 
<span class="menu-text">Project Details</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./Research Design.html" aria-current="page"> 
<span class="menu-text">Research Design</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Final Project.html"> 
<span class="menu-text">Final Project</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Concluding Thoughts.html"> 
<span class="menu-text">Conclusion</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#visualization1-what-are-the-trends-in-the-frequency-of-car-crashes-over-years" id="toc-visualization1-what-are-the-trends-in-the-frequency-of-car-crashes-over-years" class="nav-link active" data-scroll-target="#visualization1-what-are-the-trends-in-the-frequency-of-car-crashes-over-years"><span class="header-section-number">0.1</span> <strong>1. Visualization1:</strong> What are the trends in the frequency of car crashes over years?</a></li>
  <li><a href="#visualization2-how-does-the-distribution-of-car-accidents-vary-geographically" id="toc-visualization2-how-does-the-distribution-of-car-accidents-vary-geographically" class="nav-link" data-scroll-target="#visualization2-how-does-the-distribution-of-car-accidents-vary-geographically"><span class="header-section-number">0.2</span> <strong>2. Visualization2: How does the distribution of car accidents vary geographically?</strong></a></li>
  <li><a href="#visualization3-top-10-cars-which-involve-in-car-cashes" id="toc-visualization3-top-10-cars-which-involve-in-car-cashes" class="nav-link" data-scroll-target="#visualization3-top-10-cars-which-involve-in-car-cashes"><span class="header-section-number">0.3</span> <strong>3. Visualization3: Top 10 cars which involve in car cashes?</strong></a></li>
  <li><a href="#hypothesis-1-is-there-any-relation-between-weather-conditions-daylight-and-injury-severity" id="toc-hypothesis-1-is-there-any-relation-between-weather-conditions-daylight-and-injury-severity" class="nav-link" data-scroll-target="#hypothesis-1-is-there-any-relation-between-weather-conditions-daylight-and-injury-severity"><span class="header-section-number">0.4</span> <strong>4. Hypothesis #1: Is there any relation between weather conditions, daylight, and injury severity?</strong></a></li>
  <li><a href="#hypothesis-2-are-certain-types-of-vehicles-more-likely-to-be-involved-in-collisions-at-night-compared-to-during-the-day" id="toc-hypothesis-2-are-certain-types-of-vehicles-more-likely-to-be-involved-in-collisions-at-night-compared-to-during-the-day" class="nav-link" data-scroll-target="#hypothesis-2-are-certain-types-of-vehicles-more-likely-to-be-involved-in-collisions-at-night-compared-to-during-the-day"><span class="header-section-number">0.5</span> <strong>5. Hypothesis #2: Are certain types of vehicles more likely to be involved in collisions at night compared to during the day?</strong></a></li>
  <li><a href="#hypothesis-3-do-drivers-distracted-by-electronic-devices-have-a-higher-rate-of-collisions-compared-to-drivers-distracted-by-other-factors" id="toc-hypothesis-3-do-drivers-distracted-by-electronic-devices-have-a-higher-rate-of-collisions-compared-to-drivers-distracted-by-other-factors" class="nav-link" data-scroll-target="#hypothesis-3-do-drivers-distracted-by-electronic-devices-have-a-higher-rate-of-collisions-compared-to-drivers-distracted-by-other-factors"><span class="header-section-number">0.6</span> <strong>6. Hypothesis #3: Do drivers distracted by electronic devices have a higher rate of collisions compared to drivers distracted by other factors?</strong></a></li>
  <li><a href="#hypothesis-4-can-we-determine-the-effectiveness-of-different-traffic-control-measures-in-reducing-collision-rates-which-types-of-traffic-controls-are-most-effective-in-preventing-collisions" id="toc-hypothesis-4-can-we-determine-the-effectiveness-of-different-traffic-control-measures-in-reducing-collision-rates-which-types-of-traffic-controls-are-most-effective-in-preventing-collisions" class="nav-link" data-scroll-target="#hypothesis-4-can-we-determine-the-effectiveness-of-different-traffic-control-measures-in-reducing-collision-rates-which-types-of-traffic-controls-are-most-effective-in-preventing-collisions"><span class="header-section-number">0.7</span> <strong>7. Hypothesis #4: Can we determine the effectiveness of different traffic control measures in reducing collision rates? Which types of traffic controls are most effective in preventing collisions?</strong></a></li>
  <li><a href="#prediction-1-can-we-predict-the-severity-of-injuries-based-on-various-factors-such-as-weather-conditions-road-surface-conditions-and-collision-type" id="toc-prediction-1-can-we-predict-the-severity-of-injuries-based-on-various-factors-such-as-weather-conditions-road-surface-conditions-and-collision-type" class="nav-link" data-scroll-target="#prediction-1-can-we-predict-the-severity-of-injuries-based-on-various-factors-such-as-weather-conditions-road-surface-conditions-and-collision-type"><span class="header-section-number">0.8</span> <strong>8. Prediction #1: Can we predict the severity of injuries based on various factors such as weather conditions, road surface conditions, and collision type?</strong></a></li>
  <li><a href="#prediction-2-can-we-predict-the-extent-of-vehicle-damage-in-collisions-based-on-collision-type-vehicle-movement-and-speed-limit" id="toc-prediction-2-can-we-predict-the-extent-of-vehicle-damage-in-collisions-based-on-collision-type-vehicle-movement-and-speed-limit" class="nav-link" data-scroll-target="#prediction-2-can-we-predict-the-extent-of-vehicle-damage-in-collisions-based-on-collision-type-vehicle-movement-and-speed-limit"><span class="header-section-number">0.9</span> <strong>9. Prediction #2: Can we predict the extent of vehicle damage in collisions based on collision type, vehicle movement, and speed limit?</strong></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Research Design</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="visualization1-what-are-the-trends-in-the-frequency-of-car-crashes-over-years" class="level3" data-number="0.1">
<h3 data-number="0.1" class="anchored" data-anchor-id="visualization1-what-are-the-trends-in-the-frequency-of-car-crashes-over-years"><span class="header-section-number">0.1</span> <strong>1. Visualization1:</strong> What are the trends in the frequency of car crashes over years?</h3>
<div style="text-align:justify">
<p><strong>Methodology -</strong> To analyze the trend of crash frequency over the years, we will use ggplot2 in R. This allows us to create visual representations of data. We’ll transform the Crash_Date column into a date format and group the data by year. By visualizing this data, we can identify any noticeable patterns or trends in crash frequency over time.</p>
</div>
</section>
<section id="visualization2-how-does-the-distribution-of-car-accidents-vary-geographically" class="level3" data-number="0.2">
<h3 data-number="0.2" class="anchored" data-anchor-id="visualization2-how-does-the-distribution-of-car-accidents-vary-geographically"><span class="header-section-number">0.2</span> <strong>2. Visualization2: How does the distribution of car accidents vary geographically?</strong></h3>
<div style="text-align:justify">
<p><strong>Methodology -</strong> To understand the geographical distribution of car accidents, we will utilize the Leaflet package in R. This package enables us to create interactive maps displaying crash locations and associated fatalities using latitude and longitude data. By visualizing this data on a map, we can identify any geographic patterns or hotspots where accidents are more prevalent.</p>
</div>
</section>
<section id="visualization3-top-10-cars-which-involve-in-car-cashes" class="level3" data-number="0.3">
<h3 data-number="0.3" class="anchored" data-anchor-id="visualization3-top-10-cars-which-involve-in-car-cashes"><span class="header-section-number">0.3</span> <strong>3. Visualization3: Top 10 cars which involve in car cashes?</strong></h3>
<div style="text-align:justify">
<p><strong>Methodology -</strong> To identify the top 10 car manufacturers involved in car accidents, we will generate a bar plot using ggplot2 in R. This plot will showcase the most common vehicle makes involved in accidents. We’ll use dplyr for data summarization and arrangement to identify the top 10 manufacturers based on accident frequency.</p>
</div>
</section>
<section id="hypothesis-1-is-there-any-relation-between-weather-conditions-daylight-and-injury-severity" class="level3" data-number="0.4">
<h3 data-number="0.4" class="anchored" data-anchor-id="hypothesis-1-is-there-any-relation-between-weather-conditions-daylight-and-injury-severity"><span class="header-section-number">0.4</span> <strong>4. Hypothesis #1: Is there any relation between weather conditions, daylight, and injury severity?</strong></h3>
<p>Question: - Is there any relation between weather conditions, daylight, and injury severity?</p>
<div style="text-align:justify">
<p><strong>Methodology -</strong> To test this hypothesis, we will conduct a Pearson’s Chi-squared test on a contingency table. This test will analyze the association between weather conditions, daylight, and injury severity. By examining the relationship between these variables statistically, we can determine if there’s a significant correlation between them.</p>
</div>
</section>
<section id="hypothesis-2-are-certain-types-of-vehicles-more-likely-to-be-involved-in-collisions-at-night-compared-to-during-the-day" class="level3" data-number="0.5">
<h3 data-number="0.5" class="anchored" data-anchor-id="hypothesis-2-are-certain-types-of-vehicles-more-likely-to-be-involved-in-collisions-at-night-compared-to-during-the-day"><span class="header-section-number">0.5</span> <strong>5. Hypothesis #2: Are certain types of vehicles more likely to be involved in collisions at night compared to during the day?</strong></h3>
<div style="text-align:justify">
<p><strong>Methodology -</strong> To investigate this hypothesis, we will perform a Pearson’s Chi-squared test comparing collision counts involving different types of vehicles during the day and at night. By statistically analyzing collision data, we can determine if certain vehicle types are more prone to accidents during specific times of the day.</p>
</div>
</section>
<section id="hypothesis-3-do-drivers-distracted-by-electronic-devices-have-a-higher-rate-of-collisions-compared-to-drivers-distracted-by-other-factors" class="level3" data-number="0.6">
<h3 data-number="0.6" class="anchored" data-anchor-id="hypothesis-3-do-drivers-distracted-by-electronic-devices-have-a-higher-rate-of-collisions-compared-to-drivers-distracted-by-other-factors"><span class="header-section-number">0.6</span> <strong>6. Hypothesis #3: Do drivers distracted by electronic devices have a higher rate of collisions compared to drivers distracted by other factors?</strong></h3>
<div style="text-align:justify">
<p><strong>Methodology -</strong> To explore this hypothesis, we will conduct a Chi-squared test comparing collision counts between drivers distracted by electronic devices and those distracted by other factors. By examining collision data and analyzing distraction-related factors, we can determine if electronic device distraction significantly impacts collision rates.</p>
</div>
</section>
<section id="hypothesis-4-can-we-determine-the-effectiveness-of-different-traffic-control-measures-in-reducing-collision-rates-which-types-of-traffic-controls-are-most-effective-in-preventing-collisions" class="level3" data-number="0.7">
<h3 data-number="0.7" class="anchored" data-anchor-id="hypothesis-4-can-we-determine-the-effectiveness-of-different-traffic-control-measures-in-reducing-collision-rates-which-types-of-traffic-controls-are-most-effective-in-preventing-collisions"><span class="header-section-number">0.7</span> <strong>7. Hypothesis #4: Can we determine the effectiveness of different traffic control measures in reducing collision rates? Which types of traffic controls are most effective in preventing collisions?</strong></h3>
<div style="text-align:justify">
<p><strong>Methodology -</strong> To address this hypothesis, we will conduct a Pearson’s Chi-squared test between traffic control measures and injury severity. By statistically analyzing data on traffic control measures and their impact on collision rates, we can assess the effectiveness of various measures and identify the most impactful ones for preventing collisions.</p>
</div>
</section>
<section id="prediction-1-can-we-predict-the-severity-of-injuries-based-on-various-factors-such-as-weather-conditions-road-surface-conditions-and-collision-type" class="level3" data-number="0.8">
<h3 data-number="0.8" class="anchored" data-anchor-id="prediction-1-can-we-predict-the-severity-of-injuries-based-on-various-factors-such-as-weather-conditions-road-surface-conditions-and-collision-type"><span class="header-section-number">0.8</span> <strong>8. Prediction #1: Can we predict the severity of injuries based on various factors such as weather conditions, road surface conditions, and collision type?</strong></h3>
<div style="text-align:justify">
<p><strong>Methodology -</strong> To make predictions about injury severity, we will utilize a random forest classification model trained on relevant dataset. This model will analyze various factors such as weather conditions, road surface conditions, and collision type to predict injury severity. By assessing the model’s accuracy and performance, we can determine its effectiveness in predicting injury severity.</p>
</div>
</section>
<section id="prediction-2-can-we-predict-the-extent-of-vehicle-damage-in-collisions-based-on-collision-type-vehicle-movement-and-speed-limit" class="level3" data-number="0.9">
<h3 data-number="0.9" class="anchored" data-anchor-id="prediction-2-can-we-predict-the-extent-of-vehicle-damage-in-collisions-based-on-collision-type-vehicle-movement-and-speed-limit"><span class="header-section-number">0.9</span> <strong>9. Prediction #2: Can we predict the extent of vehicle damage in collisions based on collision type, vehicle movement, and speed limit?</strong></h3>
<div style="text-align:justify">
<p><strong>Methodology -</strong> To make predictions about vehicle damage extent, we will evaluate model performance using confusion matrix and key predictors. By analyzing collision data and training a predictive model, we can assess its accuracy in predicting the extent of vehicle damage based on collision type, vehicle movement, and speed limit.</p>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>